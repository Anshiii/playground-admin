Redactor.add("plugin", "imageinsert", {
    init: function (app) {
      this.app = app;
      this.toolbar = app.toolbar;
      this.inputImageValue = "null";
    },
    start: function () {
      var buttonData = {
        title: "Image",
        icon: "image",
        api: "plugin.imageinsert.loadQorMedia"
      };
  
      this.hiddenContainer = this.app.container
        .getElement()
        .nextElement()
        .find(".go-plaid-portal")
        .first();
  
      if (this.hiddenContainer.length == 0) {
        return;
      }
  
      this.toolbar.addButton("image", buttonData);
      var that = this;
      //    checking dom change and update input data
      var observe = new MutationObserver(function (mutations, observer) {
        that.selectImageInput = that.hiddenContainer.find("input");
        that.inputImageValue = that.selectImageInput
          ? that.selectImageInput.val()
          : "null";
        if (this.inputImageValue != "null") {
          that.insertQorImage();
        }
      });
      observe.observe(this.hiddenContainer.get(), {
        childList: true,
        attributes: true
      });
    },
  
    loadQorMedia: function () {
      this.hiddenContainer.find("button").trigger("click");
    },
  
    insertQorImage: function () {
      var inputImageJSON = JSON.parse(this.inputImageValue) || [];
      inputImageJSON.forEach((image) => {
        var data = {
          id: image.ID,
          title: image.FileName,
          url: image.Url,
          alt: image.Description
        };
        this.app.api("module.image.insert", { image: data });
      });
    }
  });
  